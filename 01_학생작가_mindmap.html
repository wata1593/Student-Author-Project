<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <title>âœ¨ ë‚˜ë¥¼ íƒêµ¬í•˜ëŠ” ë§ˆì¸ë“œë§µ âœ¨</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&family=Jua&display=swap"
        rel="stylesheet">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        :root {
            --primary-color: #8A2BE2;
            /* ë³´ë¼ìƒ‰ ê³„ì—´ */
            --secondary-color: #FF69B4;
            /* í•‘í¬ ê³„ì—´ */
            --accent-color: #FFD700;
            /* ë…¸ë€ìƒ‰ ê°•ì¡° */
            --bg-color: #f0f2f5;
            --text-color: #333;
            --border-color: #d1d9e6;
            --node-bg: #ffffff;
            --font-jua: 'Jua', sans-serif;
            /* í—¤ë“œë¼ì¸ìš© */
            --font-noto: 'Noto Sans KR', sans-serif;
            /* ë³¸ë¬¸ìš© */
        }

        body {
            font-family: var(--font-noto);
            background-color: var(--bg-color);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
            background-image: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
        }

        h1 {
            font-family: var(--font-jua);
            color: var(--primary-color);
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            font-size: 2.5em;
        }

        #controls {
            background: linear-gradient(45deg, #ffffff, #f0f2f5);
            border-radius: 15px;
            padding: 20px 30px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
            display: flex;
            gap: 15px;
            align-items: center;
            border: 1px solid var(--border-color);
        }

        input[type="text"] {
            padding: 12px 18px;
            border: 2px solid var(--primary-color);
            border-radius: 25px;
            outline: none;
            font-size: 1.1em;
            width: 300px;
            transition: all 0.3s ease;
            box-shadow: inset 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        input[type="text"]:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 10px rgba(var(--secondary-color), 0.3);
        }

        button {
            padding: 10px 18px;
            border: none;
            border-radius: 25px;
            background-color: var(--primary-color);
            color: white;
            font-size: 1em;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(var(--primary-color), 0.3);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        button:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(var(--secondary-color), 0.4);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 5px rgba(var(--primary-color), 0.2);
        }

        /* ë‹¤ìš´ë¡œë“œ ë²„íŠ¼ ìŠ¤íƒ€ì¼ (ë‹¤ë¥¸ ë²„íŠ¼ê³¼ ì•½ê°„ ë‹¤ë¥´ê²Œ) */
        #downloadBtn {
            background-color: #28a745;
            /* ì´ˆë¡ìƒ‰ */
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
        }

        #downloadBtn:hover {
            background-color: #218838;
            box-shadow: 0 6px 15px rgba(40, 167, 69, 0.4);
        }

        /* ë§ˆì¸ë“œë§µ íŠ¸ë¦¬ êµ¬ì¡° ìŠ¤íƒ€ì¼ë§ */
        .mindmap-wrapper {
            width: 100%;
            overflow-x: auto;
            padding: 20px;
            /* ìº¡ì²˜ ì‹œ ë°°ê²½ì´ ì˜ë¦¬ì§€ ì•Šë„ë¡ min-heightì™€ min-widthë¥¼ ì„¤ì • */
            min-height: 500px;
            min-width: 800px;
        }

        .tree {
            display: flex;
            justify-content: center;
            padding-top: 50px;
            min-width: fit-content;
            /* ë‚´ìš©ì— ë”°ë¼ ë„ˆë¹„ í™•ì¥ */
        }

        .tree ul {
            padding-top: 30px;
            /* ê°€ì§€ê°€ êº¾ì´ëŠ” ë†’ì´ */
            position: relative;
            transition: all 0.5s;
            display: flex;
            justify-content: center;
            margin: 0;
            padding-left: 0;
            list-style: none;
        }

        .tree li {
            float: left;
            /* í•˜ìœ„ ë…¸ë“œë“¤ì„ ê°€ë¡œë¡œ ë‚˜ì—´ */
            text-align: center;
            list-style-type: none;
            position: relative;
            padding: 20px 15px 0 15px;
            /* ë…¸ë“œ ê°„ ê°„ê²© */
            transition: all 0.5s;
        }

        /* ê°€ì§€ (Line) ìŠ¤íƒ€ì¼ */
        .tree li::before,
        .tree li::after {
            content: '';
            position: absolute;
            top: 0;
            right: 50%;
            border-top: 2px solid var(--primary-color);
            width: 50%;
            height: 30px;
            /* ê°€ì§€ì˜ ì„¸ë¡œ ê¸¸ì´ */
            transition: all 0.5s;
        }

        .tree li::after {
            right: auto;
            left: 50%;
            border-left: 2px solid var(--primary-color);
        }

        /* ì²« ë²ˆì§¸/ë§ˆì§€ë§‰ ìì‹ ë…¸ë“œì˜ ê°€ì§€ ì¡°ì ˆ */
        .tree li:only-child::after,
        .tree li:only-child::before {
            display: none;
        }

        .tree li:only-child {
            padding-top: 0;
        }

        .tree li:first-child::before,
        .tree li:last-child::after {
            border: 0 none;
        }

        .tree li:last-child::before {
            border-right: 2px solid var(--primary-color);
            border-radius: 0 5px 0 0;
        }

        .tree li:first-child::after {
            border-radius: 5px 0 0 0;
        }

        /* ë¶€ëª¨ì—ì„œ ìì‹ìœ¼ë¡œ ë‚´ë ¤ì˜¤ëŠ” ì„¸ë¡œ ê°€ì§€ */
        .tree ul ul::before {
            content: '';
            position: absolute;
            top: 0;
            left: 50%;
            border-left: 2px solid var(--primary-color);
            width: 0;
            height: 30px;
        }

        /* ë…¸ë“œ(Node) ìƒì ìŠ¤íƒ€ì¼ */
        .node {
            background: var(--node-bg);
            border: 2px solid var(--primary-color);
            padding: 12px 20px;
            text-decoration: none;
            color: var(--text-color);
            font-weight: bold;
            border-radius: 25px;
            /* ë‘¥ê·¼ ëª¨ì„œë¦¬ */
            display: inline-block;
            cursor: pointer;
            transition: all 0.3s ease, background 0.1s;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: relative;
            min-width: 80px;
            white-space: nowrap;
            /* ë‚´ìš©ì´ ë„˜ì¹˜ì§€ ì•Šë„ë¡ */
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .node:hover {
            background: var(--bg-color);
            border-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.15);
        }

        .node.selected {
            background: var(--accent-color) !important;
            border-color: #fbc02d !important;
            transform: scale(1.05);
            box-shadow: 0 8px 20px rgba(var(--accent-color), 0.4);
            animation: pulse-selected 1.5s infinite alternate;
            /* ì„ íƒ ê°•ì¡° ì• ë‹ˆë©”ì´ì…˜ */
        }

        /* ì„ íƒ ë…¸ë“œ ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse-selected {
            0% {
                box-shadow: 0 8px 20px rgba(255, 215, 0, 0.4);
            }

            100% {
                box-shadow: 0 10px 25px rgba(255, 215, 0, 0.6);
            }
        }

        /* ìˆ˜ì • ì…ë ¥ í•„ë“œ */
        .node-input-edit {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: calc(100% - 10px);
            /* ë…¸ë“œ íŒ¨ë”© ê³ ë ¤ */
            height: calc(100% - 10px);
            border: 2px solid var(--secondary-color);
            border-radius: 20px;
            padding: 5px;
            font-size: 1em;
            font-family: var(--font-noto);
            text-align: center;
            box-shadow: 0 0 10px rgba(var(--secondary-color), 0.4);
            z-index: 5;
            /* ë…¸ë“œ ìœ„ì— ì˜¤ë„ë¡ */
        }

        .placeholder-text {
            color: #888;
            font-style: italic;
        }
    </style>
</head>

<body>
    <a href="index.html"
        style="position: absolute; top: 15px; left: 15px; z-index: 9999; text-decoration: none; background-color: rgba(255, 255, 255, 0.8); padding: 5px 10px; border-radius: 5px; font-weight: bold; color: #333; box-shadow: 0 2px 5px rgba(0,0,0,0.2);">ğŸ 
        í™ˆìœ¼ë¡œ</a>

    <h1>âœ¨ ë‚˜ë¥¼ íƒêµ¬í•˜ëŠ” ë§ˆì¸ë“œë§µ âœ¨</h1>

    <div id="controls">
        <input type="text" id="wordInput" placeholder="ìƒˆë¡œìš´ ìƒê° ì¶”ê°€ ë˜ëŠ” ìˆ˜ì • (Enter)" autofocus>
        <button id="addNodeBtn">â• ì¶”ê°€</button>
        <button id="downloadBtn">â¬‡ï¸ JPG ë‹¤ìš´ë¡œë“œ</button>
    </div>

    <p style="font-size: 0.9em; color: #666; margin-bottom: 20px;">
        ğŸ’¡ ë°•ìŠ¤ë¥¼ í´ë¦­í•´ì„œ ì„ íƒí•œ í›„ ë‹¨ì–´ë¥¼ ì…ë ¥í•˜ë©´ ì•„ë˜ìª½ì— í•­ëª©ì´ ì¶”ê°€ë©ë‹ˆë‹¤. í•­ëª©ì„ ìˆ˜ì •í•˜ê³  ì‹¶ìœ¼ë©´ ë”ë¸”í´ë¦­í•˜ì„¸ìš”.
    </p>

    <div class="mindmap-wrapper" id="mindmapWrapper">
        <div class="tree" id="mindmap">
            <ul>
                <li>
                    <div class="node selected" onclick="selectNode(this)" ondblclick="editNode(this)">
                        <span class="node-text">ë‚˜ (Me)</span>
                    </div>
                    <ul id="root-branches"></ul>
                </li>
            </ul>
        </div>
    </div>

    <script>
        let selectedNode = document.querySelector('.selected');
        let isEditing = false; // ìˆ˜ì • ëª¨ë“œ ì—¬ë¶€

        // ë…¸ë“œ ì„ íƒ ê¸°ëŠ¥
        function selectNode(element) {
            if (isEditing) return; // ìˆ˜ì • ì¤‘ì—ëŠ” ì„ íƒ ë³€ê²½ ë°©ì§€
            if (selectedNode) selectedNode.classList.remove('selected');
            selectedNode = element;
            selectedNode.classList.add('selected');
            document.getElementById('wordInput').focus();
        }

        // ìƒˆ ë…¸ë“œ ì¶”ê°€ ë˜ëŠ” ì„ íƒëœ ë…¸ë“œ ìˆ˜ì •
        document.getElementById('wordInput').addEventListener('keypress', function (e) {
            if (e.key === 'Enter' && this.value.trim() !== "") {
                if (isEditing) {
                    // ìˆ˜ì • ëª¨ë“œì¼ ë•Œ
                    saveEdit(this.value);
                } else {
                    // ì¶”ê°€ ëª¨ë“œì¼ ë•Œ
                    addNode(this.value);
                }
                this.value = ""; // ì…ë ¥ì°½ ë¹„ìš°ê¸°
            }
        });

        document.getElementById('addNodeBtn').addEventListener('click', function () {
            const inputVal = document.getElementById('wordInput').value.trim();
            if (inputVal !== "") {
                if (isEditing) {
                    saveEdit(inputVal);
                } else {
                    addNode(inputVal);
                }
                document.getElementById('wordInput').value = "";
            }
        });

        // ë…¸ë“œ ì¶”ê°€ í•¨ìˆ˜
        function addNode(text) {
            if (!selectedNode) return;

            const parentLi = selectedNode.closest('li'); // ì„ íƒëœ ë…¸ë“œì˜ ë¶€ëª¨ li

            let childUl = parentLi.querySelector('ul');
            if (!childUl) {
                childUl = document.createElement('ul');
                parentLi.appendChild(childUl);
            }

            const newLi = document.createElement('li');
            const newNodeDiv = document.createElement('div');
            newNodeDiv.className = 'node';
            newNodeDiv.innerHTML = `<span class="node-text">${text}</span>`;
            newNodeDiv.onclick = function () { selectNode(this); };
            newNodeDiv.ondblclick = function () { editNode(this); }; // ë”ë¸”í´ë¦­ ìˆ˜ì • ì¶”ê°€

            newLi.appendChild(newNodeDiv);
            childUl.appendChild(newLi);

            selectNode(newNodeDiv); // ìƒˆë¡œ ë§Œë“  ë…¸ë“œ ì„ íƒ
        }

        // ë…¸ë“œ ìˆ˜ì • ê¸°ëŠ¥ (ë”ë¸”í´ë¦­ ì‹œ)
        function editNode(nodeElement) {
            if (isEditing) return; // ì´ë¯¸ ìˆ˜ì • ì¤‘ì´ë¼ë©´ ë¬´ì‹œ

            isEditing = true;
            const currentTextElement = nodeElement.querySelector('.node-text');
            const currentText = currentTextElement ? currentTextElement.textContent : '';

            // ê¸°ì¡´ í…ìŠ¤íŠ¸ ìˆ¨ê¸°ê³  input í•„ë“œ ìƒì„±
            currentTextElement.style.display = 'none';

            const editInput = document.createElement('input');
            editInput.type = 'text';
            editInput.className = 'node-input-edit';
            editInput.value = currentText;
            nodeElement.appendChild(editInput);
            editInput.focus();

            // Enter ë˜ëŠ” Focus Out ì‹œ ìˆ˜ì • ì™„ë£Œ
            editInput.addEventListener('keypress', function (e) {
                if (e.key === 'Enter') {
                    updateNodeText(nodeElement, editInput.value);
                }
            });
            editInput.addEventListener('blur', function () {
                updateNodeText(nodeElement, editInput.value);
            });

            // ìƒë‹¨ ì…ë ¥ì°½ì—ë„ í˜„ì¬ ë…¸ë“œ í…ìŠ¤íŠ¸ ë°˜ì˜ (í¸ì˜ì„±)
            document.getElementById('wordInput').value = currentText;
        }

        // ë…¸ë“œ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ ë° ìˆ˜ì • ëª¨ë“œ ì¢…ë£Œ
        function updateNodeText(nodeElement, newText) {
            const textToSet = newText.trim() === "" ? "ë¹ˆ ë…¸ë“œ" : newText.trim(); // ë¹ˆ ê°’ ë°©ì§€

            const currentTextElement = nodeElement.querySelector('.node-text');
            currentTextElement.textContent = textToSet;
            currentTextElement.style.display = 'inline-block'; // ë‹¤ì‹œ ë³´ì´ê²Œ

            const editInput = nodeElement.querySelector('.node-input-edit');
            if (editInput) {
                nodeElement.removeChild(editInput);
            }
            isEditing = false;
            document.getElementById('wordInput').value = ""; // ìƒë‹¨ ì…ë ¥ì°½ ì´ˆê¸°í™”
            document.getElementById('wordInput').focus(); // ë‹¤ì‹œ ìƒë‹¨ ì…ë ¥ì°½ìœ¼ë¡œ í¬ì»¤ìŠ¤
        }

        // ìƒë‹¨ ì…ë ¥ì°½ì—ì„œ ì—”í„° ì³¤ì„ ë•Œ ìˆ˜ì • ëª¨ë“œì˜€ë‹¤ë©´ ì €ì¥
        function saveEdit(newText) {
            if (selectedNode && isEditing) {
                updateNodeText(selectedNode, newText);
            }
        }

        // ì´ˆê¸° 'ë‚˜ (Me)' ë…¸ë“œ í…ìŠ¤íŠ¸ê°€ ë¹„ì–´ìˆì„ ë•Œ í”Œë ˆì´ìŠ¤í™€ë” í‘œì‹œ
        window.onload = function () {
            const rootNodeText = document.querySelector('.tree .node .node-text');
            if (rootNodeText.textContent.trim() === '') {
                rootNodeText.classList.add('placeholder-text');
                rootNodeText.textContent = 'ë‚˜ (Me) ì…ë ¥';
            }
        };

        // --- JPG ë‹¤ìš´ë¡œë“œ ê¸°ëŠ¥ ---
        document.getElementById('downloadBtn').addEventListener('click', function () {
            // í˜„ì¬ ì„ íƒëœ ë…¸ë“œì˜ ê°•ì¡°ë¥¼ ì¼ì‹œì ìœ¼ë¡œ ì œê±° (ìº¡ì²˜ì— í¬í•¨ë˜ì§€ ì•Šë„ë¡)
            const currentSelected = document.querySelector('.node.selected');
            if (currentSelected) {
                currentSelected.classList.remove('selected');
            }

            const mindmapWrapper = document.getElementById('mindmapWrapper');

            html2canvas(mindmapWrapper, {
                scale: 2, // í•´ìƒë„ 2ë°°ë¡œ ë†’ì—¬ì„œ ìº¡ì²˜ (ë” ì„ ëª…í•˜ê²Œ)
                useCORS: true, // ì™¸ë¶€ ì´ë¯¸ì§€ ë“±ì„ ì‚¬ìš©í•  ê²½ìš° í•„ìš”
                backgroundColor: null, // ì»¨í…Œì´ë„ˆì˜ ë°°ê²½ìƒ‰ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  íˆ¬ëª…í•˜ê²Œ ìº¡ì²˜ (body ë°°ê²½ì´ ë³´ì´ë„ë¡)
                allowTaint: true // ì›¹í˜ì´ì§€ì˜ ëª¨ë“  ì½˜í…ì¸ ë¥¼ ìº¡ì²˜ í—ˆìš© (ë³´ì•ˆ ê²½ê³  ë°œìƒ ê°€ëŠ¥ì„± ìˆìŒ)
            }).then(function (canvas) {
                // ì´ë¯¸ì§€ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const imageData = canvas.toDataURL('image/jpeg', 0.9); // JPG í˜•ì‹, í’ˆì§ˆ 90%

                // ë‹¤ìš´ë¡œë“œë¥¼ ìœ„í•œ ë§í¬ ìƒì„±
                const link = document.createElement('a');
                link.href = imageData;
                link.download = 'ë‚˜ë¥¼_íƒêµ¬í•˜ëŠ”_ë§ˆì¸ë“œë§µ.jpg'; // íŒŒì¼ ì´ë¦„
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);

                // ìº¡ì²˜ í›„ ì„ íƒëœ ë…¸ë“œ ê°•ì¡° ë‹¤ì‹œ ë³µì›
                if (currentSelected) {
                    currentSelected.classList.add('selected');
                }
            }).catch(error => {
                console.error('ë§ˆì¸ë“œë§µ ìº¡ì²˜ ì¤‘ ì˜¤ë¥˜ ë°œìƒ:', error);
                alert('ë§ˆì¸ë“œë§µ ìº¡ì²˜ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì½˜ì†”ì„ í™•ì¸í•´ì£¼ì„¸ìš”.');
                // ì˜¤ë¥˜ ë°œìƒ ì‹œì—ë„ ì„ íƒëœ ë…¸ë“œ ê°•ì¡° ë³µì›
                if (currentSelected) {
                    currentSelected.classList.add('selected');
                }
            });
        });

    </script>

</body>

</html>